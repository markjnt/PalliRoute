<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Wochenendtouren KW {{ calendar_week }}</title>
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: 'Helvetica','Arial',sans-serif; font-size: 12px; color:#333; }
        .header { text-align:center; margin-bottom: 24px; }
        .title { font-size: 22px; font-weight: 700; color: #007AFF; }
        .employee-section { page-break-before: always; }
        .employee-section:first-child { page-break-before: auto; }
        .employee-header { margin-bottom: 12px; padding: 10px 12px; background:#f8f9fa; border:1px solid #e9ecef; border-radius:8px; }
        .employee-name { font-size: 16px; font-weight: 600; color:#1d1d1f; }
        .appointments-table { width:100%; border-collapse: collapse; }
        .appointments-table th { background:#f5f5f5; font-weight:700; font-size: 10px; padding:6px; text-align:left; }
        .appointments-table td { font-size: 9px; padding:6px; border-bottom: 0.5px solid #ddd; vertical-align: top; }
        .patient-col { width: 35%; }
        .weekday-col { width: 32.5%; }
        .address-link, .phone-link { color:#007AFF; text-decoration: none; }
    </style>
    </head>
    <body>
        <div class="header">
            <div class="title">Wochenendtouren KW {{ calendar_week }}</div>
        </div>

        {% for emp_data in employee_routes_data %}
        <div class="employee-section" id="area-{{ emp_data.group_id }}-weekend">
            <div class="employee-header">
                <div class="employee-name">{{ emp_data.area_label }}</div>
            </div>

            <table class="appointments-table">
                <thead>
                    <tr>
                        <th class="patient-col">Patient</th>
                        <th class="weekday-col">Samstag</th>
                        <th class="weekday-col">Sonntag</th>
                    </tr>
                </thead>
                <tbody>
                    {% set rows = consolidated_by_employee[emp_data.group_id] %}
                    {% for row in rows %}
                    {% set patient = row.patient %}
                    <tr>
                        <td class="patient-col">
                            <strong>{{ patient.first_name }} {{ patient.last_name }}</strong><br>
                            <a href="https://maps.google.com/maps?q={{ patient.street }}, {{ patient.zip_code }} {{ patient.city }}" target="_blank" class="address-link">
                                {{ patient.street }}, {{ patient.zip_code }} {{ patient.city }}
                            </a>
                            {% if patient.phone1 or patient.phone2 %}<br>
                                {% if patient.phone1 %}<a href="tel:{{ patient.phone1 }}" class="phone-link">{{ patient.phone1 }}</a>{% endif %}
                                {% if patient.phone2 %}{% if patient.phone1 %} • {% endif %}<a href="tel:{{ patient.phone2 }}" class="phone-link">{{ patient.phone2 }}</a>{% endif %}
                            {% endif %}
                        </td>
                        {% set cell = row.cells['saturday'] %}
                        <td class="weekday-col">
                            {% if cell.visit_type %}<strong>{{ cell.visit_type }}</strong>{% endif %}
                            {% if cell.info %}<br>{{ cell.info }}{% endif %}
                        </td>
                        {% set cell = row.cells['sunday'] %}
                        <td class="weekday-col">
                            {% if cell.visit_type %}<strong>{{ cell.visit_type }}</strong>{% endif %}
                            {% if cell.info %}<br>{{ cell.info }}{% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}

        <div class="footer" style="text-align:center; font-size:8px; color:#999; margin-top:20px;">Erstellt am {{ current_time }} • PalliRoute</div>
    </body>
    </html>


